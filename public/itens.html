<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 30px;
            background-color: #c9adca;
            color: #832243;
        }
    </style>
</head>

<body>
    <h1>Visão Geral</h1>
    <h3>Listagem de pessoas</h3>

    <div id="status">Carregando...</div>
    <div id="lista">
        <!-- Lista de pessoas será inserida aqui -->
    </div>

    <div>
        <button id="botao" onclick="mostrarFormulario()">
            ➕ Adicionar Pessoa</button>
    </div>

    <form id="formulario" style="display: none">
        <label>Nome:</label>
        <input type="text" id="nome" name="nome" required />

        <label>Login:</label>
        <input type="text" id="login" name="login" required />

        <label>Senha:</label>
        <input type="password" id="senha" name="senha" required />

        <button type="submit" onclick="adicionarPessoa()">Adicionar pessoa</button>
    </form>

    <script>
        async function carregarPessoas() {
            const response = await fetch("/pessoas");

            //Atualizar div com id = "status"
            const elemento = document.getElementById("status");
            if (!response.ok) {
                elemento.textContent = "Não foi possível carregar as pessoas.";
            }
            elemento.textContent = "Pessoas carregadas com sucesso!";

            const pessoas = await response.json();

            const container = document.getElementById("lista");
            const ul = document.createElement('ul');

            for (let c = 0; c < pessoas.length; c++) {
                const pessoa = pessoas[c];
                const texto = `NOME: ${pessoa.nome}  -- ${pessoa.login}`;

                const li = document.createElement("li");
                li.textContent = texto;
                ul.appendChild(li);
            }
            container.appendChild(ul)
        }
           carregarPessoas();

            function mostrarFormulario() {
                const formulario = document.getElementById("formulario");
                const botao = document.getElementById("botao");

                if (formulario.style.display === "none") {
                    botao.innerText = "Ocultar formulário";
                    formulario.style.display = "block";
                } else {
                    botao.innerText = "Adicionar pessoas";
                    formulario.style.display = "none";
                }
                }
    
        function adicionarPessoa() {
            const nome = document.getElementById("nome"). value.trim();
            const login = document.getElementById("login"). value.trim();
            const senha = document.getElementById("senha"). value;

            console.log("NOME: ", nome, "\nLOGIN: ", login, "\nSENHA: ", senha)

            if(!nome || !senha || !login){
                alert("TUDO ERRADO!!!!!!!")
                return
            }

            const novaPessoa = { login, nome };
            
            const container = document.getElementById("lista");
            let ul = document.querySelector('ul');
            if(!ul) {
                ul = document.createElement('ul');
                container.appendChid(ul);
            }
            const li = createElement('li')
        li.textContent = `Nome: ${nome} -- ${login}`
        container.appendChid(li)
        }
        
        

        carregarPessoas();
    </script>
</body>

</html>